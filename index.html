<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>One Stop • MP3 Uploader</title>
    <meta
      name="description"
      content="Upload MP3 files and get instant shareable + embeddable links."
    />
    <link rel="icon" href="data:," />
    <style>
      :root {
        --bg: #0f1115; /* dark base */
        --panel: rgba(255, 255, 255, 0.06);
        --text: #e7e9ee;
        --muted: #757d8b;
        --accent: #4f8cff;
        --accent-2: #7c4dff;
        --ok: #32d296;
        --warn: #ffcc00;
        --danger: #ff5a5f;
        --ring: rgba(79, 140, 255, 0.55);
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        --radius: 18px;
      }
      @media (prefers-color-scheme: light) {
        :root {
          --bg: #0f1115;
          --panel: rgba(255, 255, 255, 0.06);
          --text: #e7e9ee;
          --muted: #757d8b;
          --accent: #4f8cff;
          --accent-2: #7c4dff;
          --ok: #32d296;
          --warn: #ffcc00;
          --danger: #ff5a5f;
          --ring: rgba(79, 140, 255, 0.55);
          --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
          --radius: 18px;
        }

        .light {
          --bg: #f7f8fb;
          --panel: #ffffff;
          --text: #0f1115;
          --muted: #596175;
          --ring: rgba(79, 140, 255, 0.45);
          --shadow: 0 10px 25px rgba(16, 24, 40, 0.08);
        }
      }
      html,
      body {
        height: 100%;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font: 15px/1.45 system-ui, -apple-system, Segoe UI, Roboto,
          "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji",
          "Segoe UI Emoji";
        color: var(--text);
        background: radial-gradient(
            1200px 800px at 10% -10%,
            rgba(124, 77, 255, 0.15),
            transparent
          ),
          radial-gradient(
            1000px 600px at 110% 10%,
            rgba(79, 140, 255, 0.18),
            transparent
          ),
          var(--bg);
      }
      .wrap {
        max-width: 1040px;
        margin: 0 auto;
        padding: 28px;
      }
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        margin-bottom: 28px;
      }
      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .logo {
        width: 36px;
        height: 36px;
        border-radius: 12px;
        background: linear-gradient(135deg, var(--accent), var(--accent-2));
        box-shadow: var(--shadow);
      }
      h1 {
        font-size: clamp(18px, 2.8vw, 24px);
        margin: 0;
      }
      .muted {
        color: var(--muted);
      }
      .controls {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .btn {
        appearance: none;
        border: 1px solid transparent;
        background: var(--panel);
        color: var(--text);
        padding: 10px 14px;
        border-radius: 12px;
        cursor: pointer;
        transition: 0.2s ease;
        box-shadow: var(--shadow);
      }
      .btn:hover {
        transform: translateY(-1px);
      }
      .btn:focus {
        outline: 3px solid var(--ring);
        outline-offset: 2px;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 18px;
      }
      .panel {
        grid-column: span 8;
        background: var(--panel);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: var(--radius);
        backdrop-filter: blur(10px);
        box-shadow: var(--shadow);
      }
      .side {
        grid-column: span 4;
      }
      @media (max-width: 920px) {
        .panel {
          grid-column: 1/-1;
        }
        .side {
          grid-column: 1/-1;
        }
      }

      .panel-head {
        padding: 18px 18px 10px;
      }
      .panel-title {
        font-weight: 700;
        font-size: 18px;
      }
      .dropzone {
        position: relative;
        margin: 16px;
        border: 2px dashed rgba(255, 255, 255, 0.18);
        border-radius: calc(var(--radius) - 6px);
        padding: 28px;
        text-align: center;
        transition: 0.2s ease;
      }
      .dropzone.drag {
        border-color: var(--accent);
        box-shadow: inset 0 0 0 2px var(--accent);
      }
      .dropzone input[type="file"] {
        position: absolute;
        inset: 0;
        opacity: 0;
        cursor: pointer;
      }
      .dz-icon {
        width: 52px;
        height: 52px;
        border-radius: 14px;
        display: inline-grid;
        place-items: center;
        margin: 0 auto 10px;
        background: linear-gradient(
          135deg,
          rgba(79, 140, 255, 0.25),
          rgba(124, 77, 255, 0.25)
        );
      }

      .rows {
        padding: 2px 12px 18px;
      }
      .row {
        display: grid;
        grid-template-columns: 42px 1fr auto;
        gap: 12px;
        align-items: center;
        padding: 10px 8px;
        border-radius: 12px;
      }
      .row + .row {
        margin-top: 6px;
      }
      .row:hover {
        background: rgba(255, 255, 255, 0.06);
      }
      .file-ico {
        width: 42px;
        height: 42px;
        border-radius: 12px;
        background: linear-gradient(
          135deg,
          rgba(79, 140, 255, 0.22),
          rgba(124, 77, 255, 0.22)
        );
        display: grid;
        place-items: center;
      }
      .name {
        font-weight: 600;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      .meta {
        font-size: 12px;
        color: var(--muted);
      }
      .actions {
        display: flex;
        gap: 6px;
      }
      .chip {
        font-size: 12px;
        padding: 6px 8px;
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }

      .progress {
        height: 8px;
        width: 100%;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.08);
        overflow: hidden;
      }
      .bar {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        transition: width 0.2s ease;
      }

      .code {
        background: #0b0d12;
        color: #e6edf3;
        border: 1px solid rgba(255, 255, 255, 0.08);
        padding: 12px;
        border-radius: 12px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", "Courier New", monospace;
        font-size: 12.5px;
        overflow: auto;
      }
      @media (prefers-color-scheme: light) {
        .code {
          background: #111827;
          color: #f3f4f6;
        }
      }

      .note {
        font-size: 13px;
        color: var(--muted);
      }
      .kbd {
        font: 600 12px/1 ui-monospace, Menlo, Monaco, Consolas, "Courier New";
        padding: 4px 6px;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.18);
      }

      /* Toast */
      .toast {
        position: fixed;
        bottom: 18px;
        left: 50%;
        transform: translateX(-50%) translateY(20px);
        opacity: 0;
        transition: 0.25s ease;
        background: var(--panel);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.12);
        color: var(--text);
        padding: 10px 14px;
        border-radius: 12px;
        box-shadow: var(--shadow);
      }
      .toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    </style>
    <!-- Pulse Player -->
     
    <style>
  .pulse-audio-player {
    max-width: 450px;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    user-select: none;
    color: #222;
    background: #fff;
    border-radius: 14px;
    padding: 18px 22px;
    box-sizing: border-box;
    border: 1px solid #ccc;
  }

  .track-info {
    margin-bottom: 14px;
  }
  .title {
    font-weight: 600;
    font-size: 1.2rem;
    line-height: 1.2;
    color: #2b2b2b;
  }
  .artist {
    font-weight: 400;
    color: #666;
    font-size: 0.9rem;
    line-height: 1.2;
    margin-top: 2px;
  }

  .player-row {
    display: flex;
    align-items: center;
    gap: 18px;
  }

  /* Play button with subtle pulse ring */
  .play-pause {
    position: relative;
    background: #4caf50;
    border: none;
    border-radius: 50%;
    width: 52px;
    height: 52px;
    color: #fff;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 12px #4caf5077;
    transition: background 0.3s ease;
  }
  .play-pause:hover,
  .play-pause:focus {
    background: #66bb6a;
    outline: none;
    box-shadow: 0 0 18px #4caf50bb;
  }
  .play-pause:active {
    background: #388e3c;
    box-shadow: 0 0 8px #2a652bbb;
  }
  .play-pause svg {
    pointer-events: none;
  }

  .pulse-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 68px;
    height: 68px;
    border-radius: 50%;
    background: rgba(76, 175, 80, 0.3);
    transform: translate(-50%, -50%) scale(1);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s ease;
    animation: pulse 1.8s infinite ease-in-out;
  }

  /* Animate pulse only when playing */
  .play-pause.playing .pulse-ring {
    opacity: 1;
  }

  @keyframes pulse {
    0% {
      transform: translate(-50%, -50%) scale(1);
      opacity: 0.5;
    }
    50% {
      transform: translate(-50%, -50%) scale(1.3);
      opacity: 0;
    }
    100% {
      transform: translate(-50%, -50%) scale(1);
      opacity: 0.5;
    }
  }

  /* Progress bar container */
  .progress-container {
    position: relative;
    flex-grow: 1;
    height: 10px;
    border-radius: 6px;
    background: #e8e8e8;
    cursor: pointer;
  }
  .progress-bar {
    position: absolute;
    top: 0;
    left: 0;
    height: 10px;
    border-radius: 6px 0 0 6px;
    background: #4caf50;
    width: 0;
    transition: width 0.1s linear;
  }
  .progress-handle {
    position: absolute;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #4caf50;
    border: 2px solid #fff;
    box-shadow: 0 0 8px #4caf5066;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  .progress-container:hover .progress-handle,
  .progress-handle:focus {
    background: #66bb6a;
    outline: none;
  }

  .time-container {
    min-width: 75px;
    font-variant-numeric: tabular-nums;
    font-size: 0.9rem;
    color: #555;
    user-select: none;
  }

  /* Volume controls */
  .volume-container {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .mute-button {
    background: transparent;
    border: none;
    color: #666;
    cursor: pointer;
    transition: color 0.3s ease;
    padding: 0;
  }
  .mute-button:hover,
  .mute-button:focus {
    color: #4caf50;
    outline: none;
  }
  .mute-button svg {
    pointer-events: none;
  }
  #volume {
    width: 80px;
    height: 6px;
    -webkit-appearance: none;
    background: #ddd;
    border-radius: 3px;
    cursor: pointer;
  }
  #volume::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 14px;
    height: 14px;
    background: #4caf50;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 8px #4caf5066;
    transition: background-color 0.3s ease;
    margin-top: -4px;
  }
  #volume:hover::-webkit-slider-thumb,
  #volume:focus::-webkit-slider-thumb {
    background: #66bb6a;
    outline: none;
    box-shadow: 0 0 12px #4caf5077;
  }
  #volume::-moz-range-thumb {
    width: 14px;
    height: 14px;
    background: #4caf50;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 8px #4caf5066;
    transition: background-color 0.3s ease;
  }
  #volume:hover::-moz-range-thumb,
  #volume:focus::-moz-range-thumb {
    background: #66bb6a;
    outline: none;
    box-shadow: 0 0 12px #4caf5077;
  }
</style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <h1>One Stop</h1>
            <div class="muted">Upload MP3 → get link → embed anywhere</div>
          </div>
        </div>
        <div class="controls">
          <button class="btn" id="themeToggle" aria-label="Toggle theme">
            🌓 Theme
          </button>
          <button class="btn" id="infoButton" aria-haspopup="dialog">
            ℹ️ Info
          </button>
        </div>
      </header>

      <main class="grid" aria-live="polite">
        <section class="panel" aria-label="Upload panel">
          <div class="panel-head">
            <div class="panel-title">Upload MP3</div>
          </div>
          <div class="dropzone" id="dropzone">
            <div class="dz-icon">🎵</div>
            <div>
              <strong>Drag & drop</strong> MP3 files here or
              <u>click to choose</u>.
            </div>
            <div class="note" style="margin-top: 6px">
              Max 4.5 MB per file • Tip: You can paste from clipboard with
              <span class="kbd">Ctrl/⌘+V</span>
            </div>
            <input
              type="file"
              id="fileInput"
              accept="audio/mpeg"
              multiple
              aria-label="Choose MP3 files"
            />
          </div>
          <div class="rows" id="rows" aria-label="Upload list">
            <!-- dynamic rows go here -->
            <div id="linkOutput"></div>
          </div>
        </section>

        <aside class="side">
          <div class="panel" style="padding: 16px">
            <h3 style="margin: 6px 6px 12px">Embed Preview</h3>
            <div
              class="code"
              id="embedCode"
              role="region"
              aria-label="Generated embed code"
              tabindex="0"
            >
              Select or upload a file to see its embed code.
            </div>
            <div style="display: flex; gap: 8px; margin-top: 10px">
              <button class="btn" id="copyCode">Copy Code</button>
              <button class="btn" id="openLink" disabled>Open Link</button>
            </div>
            <p class="note" style="margin-top: 12px">
              The code uses a direct MP3 URL. Paste it into SitePlus (HTML
              block) or any site builder that accepts custom HTML.
            </p>
          </div>

          <!-- Pulse player section  -->
          <div class="panel" style="padding: 16px; margin-top: 18px">
            <h3 style="margin: 6px 6px 12px">Pulse Player</h3>
            <div
              id="pulsePlayerContainer"
              role="region"
              aria-label="Pulse MP3 player"
            >

              <p class="note">
                This player has been styled exactly as what you see. Copy Code
                and simple paste it anywhere.
              </p>
            </div>
          </div>
          <!-- Pulse player section  -->

          <div class="panel" style="padding: 16px; margin-top: 18px">
            <h3 style="margin: 6px">Tips</h3>
            <ul class="note" style="margin: 6px 0 0 16px; padding: 0 0 6px 0">
              <li>Keep filenames simple (a-z, 0-9, dashes).</li>
              <li>
                Normalize audio levels before upload for consistent volume.
              </li>
              <li>
                Use the same host for all embeds to avoid mixed content warnings
                (HTTP vs HTTPS).
              </li>
            </ul>
          </div>
        </aside>
      </main>
    </div>

    <div class="toast" id="toast" role="status" aria-live="polite"></div>

    <dialog
      id="infoDialog"
      style="
        border: none;
        border-radius: 16px;
        padding: 0;
        max-width: 560px;
        width: 96%;
      "
    >
      <div style="padding: 18px 18px 10px; font-weight: 700">
        How uploads work
      </div>
      <div style="padding: 0 18px 18px" class="note">
        When you choose or drop an MP3 file here, it’s uploaded directly to our
        secure cloud storage (powered by Supabase). <br /><br />
        Each file gets a unique public link that you can: <br />
        <br />

        Copy and share anywhere. <br />
        <br />

        Embed on your client’s website with the provided HTML audio player code.
        <br />
        <br />

        The file is stored in a public bucket, so the link will always work
        without logging in. We don’t alter your audio — the exact file you
        upload is the one that will play.
        <br />
        <br />
        Tip: Keep filenames simple (letters, numbers, and dashes) for the
        cleanest links.
      </div>
      <div
        style="
          display: flex;
          gap: 10px;
          justify-content: flex-end;
          padding: 0 18px 18px;
        "
      >
        <button
          class="btn"
          onclick="document.getElementById('infoDialog').close()"
        >
          Close
        </button>
      </div>
    </dialog>

    <script defer>
      const MAX_SIZE = 4.5 * 1024 * 1024; // 4.5 MB

      async function uploadToServer(file, onProgress) {
        if (!file) throw new Error("No file provided");
        if (file.size > MAX_SIZE)
          throw new Error(`File exceeds max size of ${MAX_SIZE} bytes`);

        const formData = new FormData();
        formData.append("file", file);

        return new Promise((resolve, reject) => {
          const xhr = new XMLHttpRequest();
          xhr.open("POST", "/api/upload-file", true);

          // Progress event handler for upload
          xhr.upload.onprogress = (event) => {
            if (event.lengthComputable && typeof onProgress === "function") {
              onProgress(event.loaded / event.total); // fraction from 0 to 1
            }
          };

          xhr.onload = () => {
            if (xhr.status >= 200 && xhr.status < 300) {
              try {
                const response = JSON.parse(xhr.responseText);
                if (response.success) {
                  resolve({ url: response.fileUrl });
                } else {
                  reject(
                    new Error(
                      "Upload failed: " + (response.error || "unknown error")
                    )
                  );
                }
              } catch (parseError) {
                reject(new Error("Invalid JSON response from server"));
              }
            } else {
              reject(
                new Error(`Upload failed: ${xhr.status} ${xhr.responseText}`)
              );
            }
          };

          xhr.onerror = () =>
            reject(new Error("Upload failed (network error)"));

          // Send the form data containing the file
          xhr.send(formData);
        });
      }
    </script>
    <script src="scripts/ui-helper.js"></script>


<script>
    const params = new URLSearchParams(window.location.search);
const fileUrl = params.get("file");
if (fileUrl) {
  loadNewTrack(fileUrl);
}

    function loadNewTrack(fileUrl) {
  let audio = document.getElementById("audio");
  const source = document.getElementById("audio-source");

  // Set new src
  source.src = fileUrl;
  audio.load(); // Reload audio with new source
  audio.play(); // Optional: autoplay after load
}

  (function () {
    let audio = document.getElementById("audio");
    const playPause = document.getElementById("play-pause");
    const currentTimeEl = document.getElementById("current-time");
    const durationEl = document.getElementById("duration");
    const progressContainer = document.getElementById("progress-container");
    const progressBar = document.getElementById("progress-bar");
    const progressHandle = document.getElementById("progress-handle");
    const volumeInput = document.getElementById("volume");
    const muteButton = document.getElementById("mute-button");

    let dragging = false;

    function formatTime(time) {
      if (isNaN(time)) return "0:00";
      const mins = Math.floor(time / 60);
      const secs = Math.floor(time % 60);
      return mins + ":" + (secs < 10 ? "0" : "") + secs;
    }

    // Play/pause updates
    function updatePlayPause() {
      if (audio.paused) {
        playPause.setAttribute("aria-label", "Play");
        playPause.title = "Play";
        playPause.setAttribute("aria-pressed", "false");
        playPause.querySelector("svg").innerHTML =
          '<polygon points="6 4 20 12 6 20"></polygon>'; // Play shape
        playPause.classList.remove("playing");
      } else {
        playPause.setAttribute("aria-label", "Pause");
        playPause.title = "Pause";
        playPause.setAttribute("aria-pressed", "true");
        playPause.querySelector("svg").innerHTML =
          `<rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect>`; // Pause shape
        playPause.classList.add("playing");
      }
    }

    // Update progress bar and time
    function updateProgress() {
      if (!audio.duration) return;
      const percent = (audio.currentTime / audio.duration) * 100;
      progressBar.style.width = percent + "%";
      progressHandle.style.left = percent + "%";
      progressContainer.setAttribute("aria-valuenow", Math.floor(percent));
      currentTimeEl.textContent = formatTime(audio.currentTime);
    }

    // Seek audio position based on click or drag
    function seek(positionX) {
      const rect = progressContainer.getBoundingClientRect();
      let x = positionX - rect.left;
      x = Math.min(rect.width, Math.max(0, x));
      const percent = x / rect.width;
      audio.currentTime = percent * audio.duration;
    }

    // Event handlers
    playPause.addEventListener("click", () => {
      if (audio.paused) audio.play();
      else audio.pause();
      updatePlayPause();
    });
    audio.addEventListener("play", updatePlayPause);
    audio.addEventListener("pause", updatePlayPause);
    audio.addEventListener("timeupdate", () => {
      if (!dragging) updateProgress();
    });
    audio.addEventListener("loadedmetadata", () => {
      durationEl.textContent = formatTime(audio.duration);
      updateProgress();
      volumeInput.value = audio.volume;
    });

    progressContainer.addEventListener("mousedown", (e) => {
      dragging = true;
      seek(e.clientX);
    });
    window.addEventListener("mousemove", (e) => {
      if (dragging) seek(e.clientX);
    });
    window.addEventListener("mouseup", () => {
      dragging = false;
    });
    progressContainer.addEventListener("keydown", (e) => {
      if (!audio.duration) return;
      const step = audio.duration * 0.05;
      if (["ArrowRight", "ArrowUp"].includes(e.key)) {
        audio.currentTime = Math.min(audio.duration, audio.currentTime + step);
        e.preventDefault();
      } else if (["ArrowLeft", "ArrowDown"].includes(e.key)) {
        audio.currentTime = Math.max(0, audio.currentTime - step);
        e.preventDefault();
      } else if (e.key === "Home") {
        audio.currentTime = 0;
        e.preventDefault();
      } else if (e.key === "End") {
        audio.currentTime = audio.duration;
        e.preventDefault();
      }
    });

    // Volume input control
    volumeInput.addEventListener("input", (e) => {
      audio.volume = e.target.value;
      if (audio.volume === 0) {
        muteButton.setAttribute("aria-label", "Unmute");
        muteButton.title = "Unmute";
      } else {
        muteButton.setAttribute("aria-label", "Mute");
        muteButton.title = "Mute";
      }
    });

    // Mute toggle
    muteButton.addEventListener("click", () => {
      if (audio.volume > 0) {
        audio.volume = 0;
        volumeInput.value = 0;
        muteButton.setAttribute("aria-label", "Unmute");
        muteButton.title = "Unmute";
      } else {
        audio.volume = 0.5;
        volumeInput.value = 0.5;
        muteButton.setAttribute("aria-label", "Mute");
        muteButton.title = "Mute";
      }
    });

    updatePlayPause();
  })();
</script>
  </body>
</html>
